## 电动车满意度因素对电动汽车销售的影响

这一部分使用Logistic回归进行研究。模型建立思路如下：

对于任意给定客户，其对某一电动车的评分记为$x=(x_1,x_2,\ldots,x_8)$，用户是否购买记作$y={0,1}$。设$g(x)=\omega_0+\omega_1x_1+\ldots+\omega_8x_8=\omega^Tx$，其中$\omega_0,\omega_1,\ldots,\omega_8$为模型待求参数。这一函数为关于$x$的线性函数，其中$\omega_i\,(i=0,1,2,\ldots,8)$可以反映八项评分对电动汽车销售影响的重要程度。

之后定义$\sigma(x)=\dfrac{1}{1+e^{-x}}$，这一函数在$\mathbb{R}$上单调递增，值域为$(0,1)$。考虑$f(x)=\sigma(g(x))$，则这一函数可以反映$x$最终属于类别$1$的概率，即$f(x)=P(y=1|x)$

为了求解参数$\omega$，首先定义损失函数$L=$

这一模型与求解多元线性回归的模型有所相似，

## 数据处理

在第一问的分析中，不难发现原始评分明显呈左偏，经计算其偏度系数约为-0.405。满足方差分析所需的正态性假设，此处对原始评分进行了Box-Cox变换及其他措施。

Box-Cox是可用于连续型响应变量的，能够明显改善数据的正态性、对称性和方差齐性，便于后续数据分析。其通过估计待定参数$\lambda$并根据此参数对变量做变换
$$
X=\begin{cases}
\dfrac{X^{\lambda}-1}{\lambda},&\lambda\neq 0\\
\ln X,&\lambda =0\end{cases}
$$
其中要求$X=(x_1,x_2,\ldots,x_n)$满足$\forall i \in\{1,2,\ldots,n\}$，有$x_i>0$。

本例中各分数经Box-Cox变换后得到的偏度系数约为0.05，符合正态性要求；而峰度系数约为3.45，与正态分布的风度系数相比较大。之后通过如下方法对各分数做进一步正态化：

1. 记$X=(x_1,x_2,\ldots,x_n)$，其中$n<+\infty$.记$\bar{x}=\dfrac{\sum_{i=1}^n x_i}{n}$，$s=\sqrt{\dfrac{\sum_{i=1}^n (x_i-\bar{x})}{n-1}}$
2. 考虑元素$x_i$的z-分数$z_i=\dfrac{x_i-\bar{x}}{s}$，记$X^z=(z_1\times |z_1|^{-0.1},z_2\times |z_2|^{-0.1},\ldots,z_n\times |z_n|^{-0.1})$，其中$z_i$是$x_i$的z-分数

经上述变换得到的新的变量$X^z$的偏度系数接近0而峰度系数接近3，表现出较好的正态性。同时经Bartlett检验所得检验统计量为0.023，表明这组数据是方差齐性的。

## 过采样

本题所给数据中有意愿购买电动车的人数占较少一部分，在实际机器学习中由于样本数量过少，拟合结果更倾向于选择没有购买意愿。为了解决这一问题首先使用过采样（Oversampling）的方式生成一部分数据，再在包含了新生成数据的数据集上搭建神经网络。

本文使用自适应综合过采样（Adaptive Synthetic Sampling, ADASYN）方法生成数据。这种方法综合考虑了少数类的密度，通过线性方式构造新的数据，其基本算法如下所示：

记训练集$D_{tr}$中包含$m$个样本$(x_i,y_i),(i=1,2,\ldots,n)$，其中$x_i$是$n$维向量空间$\mathbb{R}^n$中的元素，$y_i\in Y=\{0,1\}$是与$x_i$关联的类别标签。记$m_s$与$m_l$为少数类与多数类中的元素数量，其中$m_s+m_l=m$，且$m_s\leqslant m_l$

记不平衡度为$d=\dfrac{m_s}{m_l}$，则$d\in(0,1]$，记能够接受的最大不平衡度为$d_0$，当$d<d_0$时进行以下操作：

1. 计算待生成样本数量$G=(m_l-m_s)\times\beta$，其中$\beta\in(0,1]$指定生成规模，当$\beta=1$时最终将会得到完全平衡的数据集
2. 对于任意属于少数类的样本$x_i$，使用欧氏距离，在$\mathbb{R}^n$中找到最近的$K$个邻居（$KNN$算法）。记其中属于多数类的样本数为$\Delta_i$，则记$r_i=\dfrac{\Delta_i}{K}$，这一比值反映了该点附近多数类样本的密度
3. 记$\hat{r}_i=\dfrac{r_i}{\sum_{i=1}^{m_s}r_i}$，不难注意到有$\sum_{i=1}^{m_s}\hat{r}_i$，则设属于少数类样本$x_i$需要合成的样本数量为$g_i=\hat{r}_i\times G$
4. 对于某个$x_i$通过如下方法生成样本：
（1）. 从$x_i$的$K$近邻样本中随机选择一个少数类样本$x_{ik}$
（2）. 取随机数$\lambda\in(0,1]$，生成样本为$x_i'=x_i+(x_{ik}-x_i)\times\lambda$

通过如上方法即可求得所需生成的样本。

## 主成分分析(PCA)

在对电动汽车评分数据进行标准化后，经检验数据之间的相关系数$\geqslant0.8$，表明数据之间具有一定的相关关系。为了避免logistic回归中多重共线性对参数估计的影响，在验证了使用条件（正向性、正态性、具有一定线性性）首先对满意度得分进行主成分分析。

主成分分析是通过对协方差矩阵进行特征值分解，将特征向量按特征值大小排列所组成的转换矩阵左乘原样本矩阵所得到的主成分矩阵。其数学含义即通过一个正交的线性变换，将原样本矩阵变换为新的矩阵，使得这一矩阵所代表的数据的任何投影的第一大方差在第一个坐标上，第二大方差在第二个坐标上。根据事先设定所需主成分的数量，不难从新矩阵中得到所需的主成分。

本题中使用sklearn包进行主成分分析，最终每个主成分能解释的方差占比如下所示：

![方差占比](D:\Files\课程\数学建模\华数杯20210805\代码\Fig\方差解释.png)

# 2B

目标客户的统计信息以离散型随机变量为主，为了研究其人口学特征与购买的关系，这里采用卡方独立性检验的方法。其中诸如年龄、工龄等特征为了方便处理使用划分区间的方法进一步做离散化处理。

卡方检验是一种不要求总体正态性的非参数检验，其中$\chi^2$统计量$\chi^2=\sum\dfrac{(f_o-f_e)^2}{f_e}$刻画了两个分类变量的相关程度，$\chi^2$统计量越大，表明观察值频数$f_o$与期望值频数$f_e$的差别越大，进而表明行列两个分类变量之间越有可能具有相关性。

本题中提出原假设$H_0$：客户的身份信息与是否购买无关；备择假设$H_1$：客户的身份信息与是否购买无关。事先指定犯错误的概率$\alpha=0.1$，则各变量卡方值如下：

（表格：卡方表格.xlsx）

将下列结果汇总如下图所示，则由此初步分析知收支状况、借贷情况、居住地带、工作单位性质及职业等属性较明显地与客户是否愿意购买电动汽车相关。其中贷款状况强烈影响客户的购买意愿，偿还房贷支出占家庭总收入超10%的客户群体中仅有1%的客户有意愿购买电动汽车，而这一支出占比超20%的家庭购买意愿降低到0%，偿还车贷的群体也有着类似的结论；对于不同收入水平的家庭而言，整体呈现中等收入家庭（个人）的购买意愿更强，这一结论也是符合常识的；居住地带上，市中心的客户群体更愿意购买电动汽车，这一情况一定程度上与城市中相关设施建设落实相关；而在工作单位与个人职业属性上，整体呈现出从事个体工商业群体、自由职业的群体及公司职员相对更愿意购买电动汽车，这一情况一定程度上与其收入水平及工作内容及电动车的平均售价有关。而部分特征与客户是否有意愿购买的相关度不高，如客户的婚姻家庭信息、年龄与车龄信息等

（图片：chi2-p.png）